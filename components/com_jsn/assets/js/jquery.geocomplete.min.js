!function(a,b,c,d){function h(b,c){this.options=a.extend(!0,{},e,c),this.input=b,this.$input=a(b),this._defaults=e,this._name="geocomplete";var f=this.options.details,g=this.options.detailsAttribute,h=this.options.map;if(this.init(),(this.options.addReset||this.options.addPosition)&&this.options.wrap&&this.$input.wrap('<div class="input-prepend" />'),a(b).blur(function(){""==a(f+" ["+g+"='lat']").val()&&a(b).val("")}),this.options.addPosition){var i=navigator.geolocation!==d;i&&(this.$input.before('<a class="btn btn-success" id="'+g+'-geolocation"><i class="jsn-icon jsn-icon-map-marker"></i></a>'),a("#"+g+"-geolocation").click(function(){return navigator.geolocation.getCurrentPosition(function(c){a(b).geocomplete("init"),a(b).geocomplete("geocode",{address:c.coords.latitude+","+c.coords.longitude})}),!1}))}this.options.addReset&&(this.$input.before('<a class="btn btn-danger" id="'+g+'-reset"><i class="jsn-icon jsn-icon-remove"></i></a>'),a("#"+g+"-reset").click(function(){return a(f+" ["+g+"='lat']").val(""),a(f+" ["+g+"='lng']").val(""),a(b).val(""),a(h).hide(),!1})),a(h).hide()}var e={bounds:!0,country:null,map:!1,details:!1,detailsAttribute:"name",detailsScope:null,autoselect:!0,location:!1,addReset:!1,addPosition:!1,wrap:!0,mapOptions:{zoom:14,scrollwheel:!1,mapTypeId:"roadmap"},markerOptions:{draggable:!1},maxZoom:16,types:["geocode"],blur:!1,geocodeAfterResult:!1,restoreValueAfterBlur:!1},f="street_address route intersection political country administrative_area_level_1 administrative_area_level_2 administrative_area_level_3 colloquial_area locality sublocality neighborhood premise subpremise postal_code natural_feature airport park point_of_interest post_box street_number floor room lat lng viewport location formatted_address location_type bounds".split(" "),g="id place_id url website vicinity reference name rating international_phone_number icon formatted_phone_number".split(" ");a.extend(h.prototype,{init:function(){this.justStart=!0,this.initMap(),this.initMarker(),this.initGeocoder(),this.initDetails(),this.initLocation()},initMap:function(){if(this.options.map){if("function"==typeof this.options.map.setCenter)return void(this.map=this.options.map);this.map=new google.maps.Map(a(this.options.map)[0],this.options.mapOptions),google.maps.event.addListener(this.map,"click",a.proxy(this.mapClicked,this)),google.maps.event.addListener(this.map,"dragend",a.proxy(this.mapDragged,this)),google.maps.event.addListener(this.map,"idle",a.proxy(this.mapIdle,this)),google.maps.event.addListener(this.map,"zoom_changed",a.proxy(this.mapZoomed,this))}},initMarker:function(){if(this.map){var b=a.extend(this.options.markerOptions,{map:this.map});b.disabled||(this.marker=new google.maps.Marker(b),google.maps.event.addListener(this.marker,"dragend",a.proxy(this.markerDragged,this)))}},initGeocoder:function(){var c={types:this.options.types,bounds:this.options.bounds===!0?null:this.options.bounds,componentRestrictions:this.options.componentRestrictions};this.options.country&&(c.componentRestrictions={country:this.options.country}),a(this.input).is("input")&&(this.autocomplete=new google.maps.places.Autocomplete(this.input,c)),this.geocoder=new google.maps.Geocoder,a(this.input).is("input")&&this.map&&this.options.bounds===!0&&this.autocomplete.bindTo("bounds",this.map),a(this.input).is("input")&&google.maps.event.addListener(this.autocomplete,"place_changed",a.proxy(this.placeChanged,this)),this.$input.on("keypress."+this._name,function(a){if(13===a.keyCode)return!1}),this.options.geocodeAfterResult===!0&&this.$input.bind("keypress."+this._name,a.proxy(function(){9!=event.keyCode&&this.selected===!0&&(this.selected=!1)},this)),this.$input.bind("geocode."+this._name,a.proxy(function(){this.find()},this)),this.$input.bind("geocode:result."+this._name,a.proxy(function(){this.lastInputVal=this.$input.val()},this)),this.options.blur===!0&&this.$input.on("blur."+this._name,a.proxy(function(){this.options.geocodeAfterResult===!0&&this.selected===!0||(this.options.restoreValueAfterBlur===!0?setTimeout(a.proxy(this.restoreLastValue,this),0):this.find())},this))},initDetails:function(){function e(a){d[a]=b.find("["+c+"="+a+"]")}if(this.options.details){if(this.options.detailsScope)var b=a(this.input).parents(this.options.detailsScope).find(this.options.details);else var b=a(this.options.details);var c=this.options.detailsAttribute,d={};a.each(f,function(a,b){e(b),e(b+"_short")}),a.each(g,function(a,b){e(b)}),this.$details=b,this.details=d}},initLocation:function(){var b,a=this.options.location;if(a){if("string"==typeof a)return void this.find(a);a instanceof Array&&(b=new google.maps.LatLng(a[0],a[1])),a instanceof google.maps.LatLng&&(b=a),b&&(this.map&&this.map.setCenter(b),this.marker&&this.marker.setPosition(b))}},destroy:function(){this.map&&(google.maps.event.clearInstanceListeners(this.map),google.maps.event.clearInstanceListeners(this.marker)),this.autocomplete.unbindAll(),google.maps.event.clearInstanceListeners(this.autocomplete),google.maps.event.clearInstanceListeners(this.input),this.$input.removeData(),this.$input.off(this._name),this.$input.unbind("."+this._name)},find:function(a){this.geocode({address:a||this.$input.val()})},geocode:function(b){b.address&&(this.options.bounds&&!b.bounds&&(this.options.bounds===!0?b.bounds=this.map&&this.map.getBounds():b.bounds=this.options.bounds),this.options.country&&(b.region=this.options.country),this.geocoder.geocode(b,a.proxy(this.handleGeocode,this)))},selectFirstResult:function(){var b="";a(".pac-item-selected")[0]&&(b="-selected");var c=a(".pac-container:visible .pac-item"+b+":first span:nth-child(2)").text(),d=a(".pac-container:visible .pac-item"+b+":first span:nth-child(3)").text(),e=c;return d&&(e+=" - "+d),this.$input.val(e),e},restoreLastValue:function(){this.lastInputVal&&this.$input.val(this.lastInputVal)},handleGeocode:function(a,b){if(b===google.maps.GeocoderStatus.OK){var c=a[0];this.justStart&&0!=this.$input.val().length||this.$input.val(c.formatted_address),this.justStart=!1,this.update(c),a.length>1&&this.trigger("geocode:multiple",a)}else this.trigger("geocode:error",b)},trigger:function(a,b){this.$input.trigger(a,[b])},center:function(a){a.viewport?(this.map.fitBounds(a.viewport),this.map.getZoom()>this.options.maxZoom&&this.map.setZoom(this.options.maxZoom)):(this.map.setZoom(this.options.maxZoom),this.map.setCenter(a.location)),this.marker&&(this.marker.setPosition(a.location),this.marker.setAnimation(this.options.markerOptions.animation))},update:function(b){this.map&&(a(this.options.map).show(),a(this.options.map).is(":visible")&&a(this.options.map).attr("data-loaded","true"),this.initMap(),this.initMarker(),this.center(b.geometry)),this.$details&&this.fillDetails(b),this.trigger("geocode:result",b)},fillDetails:function(b){var c={},d=b.geometry,e=d.viewport,f=d.bounds;a.each(b.address_components,function(b,d){d.types[0];a.each(d.types,function(a,b){c[b]=d.long_name,c[b+"_short"]=d.short_name})}),a.each(g,function(a,d){c[d]=b[d]}),a.extend(c,{formatted_address:b.formatted_address,location_type:d.location_type||"PLACES",viewport:e,bounds:f,location:d.location,lat:d.location.lat(),lng:d.location.lng()}),a.each(this.details,a.proxy(function(a,b){var d=c[a];this.setDetail(b,d)},this)),this.data=c},setDetail:function(a,b){b===d?b="":"function"==typeof b.toUrlValue&&(b=b.toUrlValue()),a.is(":input")?a.val(b):a.text(b)},markerDragged:function(a){this.trigger("geocode:dragged",a.latLng),this.setDetail(this.details.lat,a.latLng.lat()),this.setDetail(this.details.lng,a.latLng.lng())},mapClicked:function(a){this.trigger("geocode:click",a.latLng)},mapDragged:function(a){this.trigger("geocode:mapdragged",this.map.getCenter())},mapIdle:function(a){this.trigger("geocode:idle",this.map.getCenter())},mapZoomed:function(a){this.trigger("geocode:zoom",this.map.getZoom())},resetMarker:function(){this.marker.setPosition(this.data.location),this.setDetail(this.details.lat,this.data.location.lat()),this.setDetail(this.details.lng,this.data.location.lng())},placeChanged:function(){var a=this.autocomplete.getPlace();if(this.selected=!0,a.geometry)this.update(a);else if(this.options.autoselect){var b=this.selectFirstResult();this.find(b)}}}),a.fn.geocomplete=function(b){var c="plugin_geocomplete";if("string"==typeof b){var d=a(this).data(c)||a(this).geocomplete().data(c),e=d[b];return"function"==typeof e?(e.apply(d,Array.prototype.slice.call(arguments,1)),a(this)):(2==arguments.length&&(e=arguments[1]),e)}return this.each(function(){var d=a.data(this,c);d||(d=new h(this,b),a.data(this,c,d))})}}(jQuery,window,document);